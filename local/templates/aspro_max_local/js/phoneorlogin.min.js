$.fn.phoneOrLogin=function(a){function s(e,a){var o,n,l,s,i,r,t=$(e),p=t.closest(".phone_or_login"),h=t.val(),m=t.data("code"),i=(n=(o=h).replace(/[\s-_()]/g,""),l=o.replace(/[\s()]/g,""),i=s=!1,n.length&&((s=!!n.match(/^\+?\d*$/))||(i=-1!==l.indexOf("@"),console.log("Отправка почты RR: "+o),(window.rrApiOnReady=window.rrApiOnReady||[]).push(function(){rrApi.setEmail(o)}))),{value:o,clearPhone:n,bPossiblePhone:s,clearLogin:l,bPossibleEmail:i});if(h.length)if(i.bPossiblePhone){if(p.hasClass("phone_or_login-phone")){if(arMaxOptions.THEME.PHONE_MASK.length&&m.length&&(r=arMaxOptions.THEME.PHONE_MASK.replace(/\\9/,"#").replace(/[^0-8+#]/g,"").replace(/#/,"9")).length){for(c="[+?]",_=m+t.inputmask("unmaskedvalue"),E="",d=0;d<_.length;++d)if("+"!==(g=_.charAt(d))||d){v=c+("8"!==g||d&&(1!=d||"+"!==E)?g:"[78]"),u=new RegExp("^"+v);if(!r.match(u))break;c=v,E+=g}else E+=g;t.data("code",E),m!=E&&(t.val(_),M=arMaxOptions.THEME.PHONE_MASK.replace(/\\9/,"#").replace(/9/g,"*").replace(/#/,"\\9"),t.inputmask("mask",{mask:M}))}}else if(t.removeClass("email").addClass("phone"),p.removeClass("phone_or_login-login").removeClass("phone_or_login-email").addClass("phone_or_login-phone"),arMaxOptions.THEME.PHONE_MASK.length)if((r=arMaxOptions.THEME.PHONE_MASK.replace(/\\9/,"#").replace(/[^0-8+#]/g,"").replace(/#/,"9")).length){for(var g,c="[+?]",_=h,E="",d=0;d<_.length;++d)if("+"!==(g=_.charAt(d))||d){var v=c+("8"!==g||d&&(1!=d||"+"!==E)?g:"[78]"),u=new RegExp("^"+v);if(!r.match(u))break;c=v,E+=g}else E+=g;t.data("code",E),r.match(new RegExp("^"+c+"$"))&&t.val(_.substr(E.length));var M=arMaxOptions.THEME.PHONE_MASK.replace(/\\9/,"#").replace(/9/g,"*").replace(/#/,"\\9");t.inputmask("mask",{mask:M})}else{var M=arMaxOptions.THEME.PHONE_MASK.replace(/\\9/,"#").replace(/9/g,"*").replace(/#/,"\\9");t.inputmask("mask",{mask:M})}}else i.bPossibleEmail?p.hasClass("phone_or_login-email")||(t.removeClass("phone").addClass("email"),p.removeClass("phone_or_login-phone").removeClass("phone_or_login-login").addClass("phone_or_login-email"),arMaxOptions.THEME.PHONE_MASK.length&&(t.inputmask("mask",{mask:""}),$(e).val(m+$(e).val()))):p.hasClass("phone_or_login-login")||(t.removeClass("phone").removeClass("email"),p.removeClass("phone_or_login-phone").removeClass("phone_or_login-email").addClass("phone_or_login-login"),arMaxOptions.THEME.PHONE_MASK.length&&(t.inputmask("mask",{mask:""}),$(e).val(m+$(e).val())));else(p.hasClass("phone_or_login-login")||p.hasClass("phone_or_login-email")||p.hasClass("phone_or_login-phone"))&&(p.removeClass("phone_or_login-phone").removeClass("phone_or_login-login").removeClass("phone_or_login-email"),t.removeClass("phone").removeClass("email"),t.inputmask("mask",{mask:""}),t.data("code",""));"function"==typeof a&&a(e,i)}$(this).length&&$(this).each(function(){var e,o,n,l;e=this,o=a,n=$(e),l=!1,void 0===n.data("phonecode")&&(n.data({phonecode:""}),n.data("code",""),n.bind({keydown:function(e){var a;255!=e.which&&(a=this,l&&clearTimeout(l),l=setTimeout(function(){s(a,o)},50))},blur:function(e){var a=!n.val().length;arMaxOptions.THEME.PHONE_MASK.length&&(a|=arMaxOptions.THEME.PHONE_MASK.replace(/9/g,"_")==n.val()),a&&(n.hasClass("required")&&n.parent().find("label.error").html(BX.message("JS_REQUIRED")),n.inputmask("mask",{mask:""}),n.data("code","")),s(this,o)},paste:function(e){var a=this;l&&clearTimeout(l),l=setTimeout(function(){s(a,o)},50)},cut:function(e){var a=this;l&&clearTimeout(l),l=setTimeout(function(){s(a,o)},50)}}),s(e,o))})};
