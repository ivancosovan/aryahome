$.fn.phoneOrLogin=function(a){function s(e,a){var o,l,n,s,i,r,t=$(e),p=t.closest(".phone_or_login"),h=t.val(),m=t.data("code"),i=(l=(o=h).replace(/[\s-_()]/g,""),n=o.replace(/[\s()]/g,""),i=s=!1,l.length&&((s=!!l.match(/^\+?\d*$/))||(i=-1!==n.indexOf("@"))),{value:o,clearPhone:l,bPossiblePhone:s,clearLogin:n,bPossibleEmail:i});if(h.length)if(i.bPossiblePhone){if(p.hasClass("phone_or_login-phone")){if(arMaxOptions.THEME.PHONE_MASK.length&&m.length&&(r=arMaxOptions.THEME.PHONE_MASK.replace(/\\9/,"#").replace(/[^0-8+#]/g,"").replace(/#/,"9")).length){for(c="[+?]",_=m+t.inputmask("unmaskedvalue"),E="",v=0;v<_.length;++v)if("+"!==(g=_.charAt(v))||v){d=c+("8"!==g||v&&(1!=v||"+"!==E)?g:"[78]"),M=new RegExp("^"+d);if(!r.match(M))break;c=d,E+=g}else E+=g;t.data("code",E),m!=E&&(t.val(_),u=arMaxOptions.THEME.PHONE_MASK.replace(/\\9/,"#").replace(/9/g,"*").replace(/#/,"\\9"),t.inputmask("mask",{mask:u}))}}else if(t.removeClass("email").addClass("phone"),p.removeClass("phone_or_login-login").removeClass("phone_or_login-email").addClass("phone_or_login-phone"),arMaxOptions.THEME.PHONE_MASK.length)if((r=arMaxOptions.THEME.PHONE_MASK.replace(/\\9/,"#").replace(/[^0-8+#]/g,"").replace(/#/,"9")).length){for(var g,c="[+?]",_=h,E="",v=0;v<_.length;++v)if("+"!==(g=_.charAt(v))||v){var d=c+("8"!==g||v&&(1!=v||"+"!==E)?g:"[78]"),M=new RegExp("^"+d);if(!r.match(M))break;c=d,E+=g}else E+=g;t.data("code",E),r.match(new RegExp("^"+c+"$"))&&t.val(_.substr(E.length));var u=arMaxOptions.THEME.PHONE_MASK.replace(/\\9/,"#").replace(/9/g,"*").replace(/#/,"\\9");t.inputmask("mask",{mask:u})}else{var u=arMaxOptions.THEME.PHONE_MASK.replace(/\\9/,"#").replace(/9/g,"*").replace(/#/,"\\9");t.inputmask("mask",{mask:u})}}else i.bPossibleEmail?p.hasClass("phone_or_login-email")||(t.removeClass("phone").addClass("email"),p.removeClass("phone_or_login-phone").removeClass("phone_or_login-login").addClass("phone_or_login-email"),arMaxOptions.THEME.PHONE_MASK.length&&(t.inputmask("mask",{mask:""}),$(e).val(m+$(e).val()))):p.hasClass("phone_or_login-login")||(t.removeClass("phone").removeClass("email"),p.removeClass("phone_or_login-phone").removeClass("phone_or_login-email").addClass("phone_or_login-login"),arMaxOptions.THEME.PHONE_MASK.length&&(t.inputmask("mask",{mask:""}),$(e).val(m+$(e).val())));else(p.hasClass("phone_or_login-login")||p.hasClass("phone_or_login-email")||p.hasClass("phone_or_login-phone"))&&(p.removeClass("phone_or_login-phone").removeClass("phone_or_login-login").removeClass("phone_or_login-email"),t.removeClass("phone").removeClass("email"),t.inputmask("mask",{mask:""}),t.data("code",""));"function"==typeof a&&a(e,i)}$(this).length&&$(this).each(function(){var e,o,l,n;e=this,o=a,l=$(e),n=!1,void 0===l.data("phonecode")&&(l.data({phonecode:""}),l.data("code",""),l.bind({keydown:function(e){var a;255!=e.which&&(a=this,n&&clearTimeout(n),n=setTimeout(function(){s(a,o)},50))},blur:function(e){var a=!l.val().length;arMaxOptions.THEME.PHONE_MASK.length&&(a|=arMaxOptions.THEME.PHONE_MASK.replace(/9/g,"_")==l.val()),a&&(l.hasClass("required")&&l.parent().find("label.error").html(BX.message("JS_REQUIRED")),l.inputmask("mask",{mask:""}),l.data("code","")),s(this,o)},paste:function(e){var a=this;n&&clearTimeout(n),n=setTimeout(function(){s(a,o)},50)},cut:function(e){var a=this;n&&clearTimeout(n),n=setTimeout(function(){s(a,o)},50)}}),s(e,o))})};
